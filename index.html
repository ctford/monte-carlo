<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monte Carlo Project Completion Estimator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .section {
            display: flex;
            flex-direction: column;
        }

        .section h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .input-group input,
        .input-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .input-group input:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .input-group small {
            display: block;
            margin-top: 4px;
            color: #666;
            font-size: 12px;
        }

        .results {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        @media (max-width: 600px) {
            .results {
                grid-template-columns: 1fr;
            }
        }

        .result-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .result-card.p85 {
            border-left-color: #f59e0b;
        }

        .result-card.p95 {
            border-left-color: #ef4444;
        }

        .result-label {
            font-size: 12px;
            text-transform: uppercase;
            color: #666;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .result-date {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            font-variant-numeric: tabular-nums;
        }

        .result-days {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }

        canvas {
            width: 100%;
            height: auto;
            margin-top: 20px;
            border-radius: 8px;
            background: #f9fafb;
        }

        .stats {
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 13px;
            line-height: 1.6;
            color: #555;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }

        .stats-row:last-child {
            border-bottom: none;
        }

        .stats-label {
            font-weight: 500;
        }

        .stats-value {
            font-weight: 600;
            color: #333;
            font-variant-numeric: tabular-nums;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-calculate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-calculate:active {
            transform: translateY(0);
        }

        .btn-reset {
            background: #e5e7eb;
            color: #333;
        }

        .btn-reset:hover {
            background: #d1d5db;
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #dc2626;
            display: none;
        }

        .error.show {
            display: block;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .tooltip-trigger {
            position: relative;
            cursor: help;
            border-bottom: 1px dotted #667eea;
        }

        .tooltip-trigger:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .tooltip-trigger:hover::before {
            content: '';
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #333;
            z-index: 1000;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Monte Carlo Project Estimator</h1>
            <p>Estimate project completion dates based on historical cycle time</p>
        </div>

        <div class="content">
            <div class="section">
                <h2>Input Parameters</h2>

                <div class="error" id="error"></div>

                <div class="input-group">
                    <label for="cycleTimes">Historical Throughput <span class="tooltip-trigger" data-tooltip="How many items your team completes per week">?</span></label>
                    <input type="text" id="cycleTimes" value="0 1 2 2 3 3 5" placeholder="e.g.: 5 3 8 4 6 7 5 or 5, 3, 8, 4, 6, 7, 5">
                    <small>Items per week (space or comma separated)</small>
                </div>

                <div class="input-group">
                    <label for="totalWork">Total Work Remaining</label>
                    <input type="number" id="totalWork" value="50" min="1" step="1">
                    <small>Number of items/units still to be completed</small>
                </div>

                <div class="input-group">
                    <label for="simulations">Monte Carlo Simulations</label>
                    <input type="number" id="simulations" value="10000" min="100" step="100">
                    <small>More simulations = more accurate but slower</small>
                </div>

                <div class="button-group">
                    <button class="btn-reset" onclick="clearInputs()">Clear</button>
                </div>


            </div>

            <div class="section">
                <h2>Completion Date Estimates (Vacation Excluded)</h2>

                <div class="results" id="results" style="display: none;">
                    <div class="result-card">
                        <div class="result-label">50th Percentile (Median)</div>
                        <div class="result-date" id="p50Date">-</div>
                        <div class="result-days" id="p50Weeks">-</div>
                    </div>
                    <div class="result-card p85">
                        <div class="result-label">85th Percentile</div>
                        <div class="result-date" id="p85Date">-</div>
                        <div class="result-days" id="p85Weeks">-</div>
                    </div>
                    <div class="result-card p95">
                        <div class="result-label">95th Percentile</div>
                        <div class="result-date" id="p95Date">-</div>
                        <div class="result-days" id="p95Weeks">-</div>
                    </div>
                </div>

                <canvas id="distributionChart"></canvas>

                <div class="stats" id="stats" style="display: none;">
                    <div class="stats-row">
                        <span class="stats-label">Avg Cycle Time:</span>
                        <span class="stats-value" id="statAvgCycle">-</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Std Dev:</span>
                        <span class="stats-value" id="statStdDev">-</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Min estimate:</span>
                        <span class="stats-value" id="statMin">-</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Max estimate:</span>
                        <span class="stats-value" id="statMax">-</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Span:</span>
                        <span class="stats-value" id="statSpan">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let simulationResults = null;

        function parseInputs() {
            const throughputPerWeek = document.getElementById('cycleTimes').value
                .split(/[\s,]+/)
                .map(s => parseFloat(s.trim()))
                .filter(n => !isNaN(n) && n >= 0);

            // Convert items per week to working days per item (5-day week)
            const cycleTimes = throughputPerWeek.map(tp => 5 / tp);

            const totalWork = parseFloat(document.getElementById('totalWork').value);
            const simulations = parseInt(document.getElementById('simulations').value);

            return { cycleTimes, totalWork, simulations };
        }

        function showError(message) {
            const errorEl = document.getElementById('error');
            errorEl.textContent = message;
            errorEl.classList.add('show');
        }

        function clearError() {
            document.getElementById('error').classList.remove('show');
        }

        function validateInputs(cycleTimes, totalWork, simulations) {
            if (cycleTimes.length === 0) {
                throw new Error('Please enter at least one cycle time');
            }
            if (cycleTimes.length < 3) {
                throw new Error('Please enter at least 3 historical cycle times for meaningful statistics');
            }
            if (totalWork < 1) {
                throw new Error('Total work must be at least 1');
            }
            if (simulations < 100) {
                throw new Error('Need at least 100 simulations');
            }
        }

        function calculateMean(arr) {
            return arr.reduce((a, b) => a + b, 0) / arr.length;
        }

        function calculateStdDev(arr, mean) {
            const variance = arr.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / arr.length;
            return Math.sqrt(variance);
        }

        function runMonteCarloSimulation(cycleTimes, totalWork, numSimulations) {
            const mean = calculateMean(cycleTimes);
            const stdDev = calculateStdDev(cycleTimes, mean);
            const results = [];

            for (let i = 0; i < numSimulations; i++) {
                let daysElapsed = 0;
                let itemsCompleted = 0;

                while (itemsCompleted < totalWork) {
                    // Sample from normal distribution using Box-Muller transform
                    const u1 = Math.random();
                    const u2 = Math.random();
                    const z = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);
                    const cycleTime = Math.max(0.1, mean + z * stdDev);
                    
                    daysElapsed += cycleTime;
                    itemsCompleted++;
                }

                results.push(daysElapsed);
            }

            return results.sort((a, b) => a - b);
        }

        function getPercentile(sortedArray, percentile) {
            const index = Math.ceil((percentile / 100) * sortedArray.length) - 1;
            return sortedArray[Math.max(0, index)];
        }

        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + Math.round(days));
            return result;
        }

        function formatDate(date) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function drawDistributionChart(results) {
            const canvas = document.getElementById('distributionChart');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = canvas.offsetWidth;
            canvas.height = 320;

            const padding = 50;
            const bottomPadding = 60;
            const width = canvas.width - padding - 40;
            const height = canvas.height - padding - bottomPadding;

            const minDays = Math.min(...results);
            const maxDays = Math.max(...results);
            const range = maxDays - minDays || 1;

            // Clear canvas
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw grid
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (height / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + width, y);
                ctx.stroke();
            }

            // Calculate CDF for S-curve
            const points = [];
            for (let i = 0; i < results.length; i++) {
                const x = padding + ((results[i] - minDays) / range) * width;
                const y = padding + height - (i / results.length) * height;
                points.push({ x, y });
            }

            // Draw S-curve
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            for (let i = 1; i < points.length; i++) {
                ctx.lineTo(points[i].x, points[i].y);
            }
            ctx.stroke();

            // Draw percentile lines
            const p50 = getPercentile(results, 50);
            const p85 = getPercentile(results, 85);
            const p95 = getPercentile(results, 95);

            const percentiles = [
                { value: p50, color: '#667eea', label: 'p50' },
                { value: p85, color: '#f59e0b', label: 'p85' },
                { value: p95, color: '#ef4444', label: 'p95' }
            ];

            percentiles.forEach(p => {
                const x = padding + ((p.value - minDays) / range) * width;
                
                // Vertical line
                ctx.strokeStyle = p.color;
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, padding + height);
                ctx.stroke();
                ctx.setLineDash([]);

                // Label above the line
                ctx.fillStyle = p.color;
                ctx.font = 'bold 12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(p.label, x, padding - 15);
            });

            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding + height);
            ctx.lineTo(padding + width, padding + height);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, padding + height);
            ctx.stroke();

            // Axis labels
            ctx.fillStyle = '#666';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('Days to Completion', canvas.width / 2, canvas.height - 8);

            ctx.save();
            ctx.translate(-5, padding + height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText('Cumulative Probability', 0, 0);
            ctx.restore();

            // Axis tick labels - convert days to weeks
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            ctx.fillStyle = '#666';
            for (let i = 0; i <= 5; i++) {
                const days = minDays + (range / 5) * i;
                const weeks = (days / 7).toFixed(1);
                const x = padding + (width / 5) * i;
                ctx.fillText(weeks + 'w', x, padding + height + 15);
            }

            ctx.textAlign = 'right';
            ctx.textBaseline = 'middle';
            for (let i = 0; i <= 5; i++) {
                const pct = Math.round((i / 5) * 100);
                const y = padding + height - (height / 5) * i;
                ctx.fillText(pct + '%', padding - 15, y);
            }
        }

        function calculateEstimate() {
            try {
                clearError();
                const { cycleTimes, totalWork, simulations } = parseInputs();
                validateInputs(cycleTimes, totalWork, simulations);

                setTimeout(() => {
                    simulationResults = runMonteCarloSimulation(cycleTimes, totalWork, simulations);
                    displayResults(cycleTimes);
                }, 10);

            } catch (error) {
                showError(error.message);
            }
        }

        function displayResults(cycleTimes) {
            const p50 = getPercentile(simulationResults, 50);
            const p85 = getPercentile(simulationResults, 85);
            const p95 = getPercentile(simulationResults, 95);

            const today = new Date();
            const date50 = addDays(today, p50);
            const date85 = addDays(today, p85);
            const date95 = addDays(today, p95);

            // Convert days to weeks for display
            const weeks50 = p50 / 7;
            const weeks85 = p85 / 7;
            const weeks95 = p95 / 7;

            document.getElementById('p50Date').textContent = formatDate(date50);
            document.getElementById('p50Weeks').textContent = `${weeks50.toFixed(1)} weeks`;
            document.getElementById('p85Date').textContent = formatDate(date85);
            document.getElementById('p85Weeks').textContent = `${weeks85.toFixed(1)} weeks`;
            document.getElementById('p95Date').textContent = formatDate(date95);
            document.getElementById('p95Weeks').textContent = `${weeks95.toFixed(1)} weeks`;

            const mean = calculateMean(cycleTimes);
            const stdDev = calculateStdDev(cycleTimes, mean);
            const minDays = Math.min(...simulationResults);
            const maxDays = Math.max(...simulationResults);

            document.getElementById('statAvgCycle').textContent = mean.toFixed(2) + ' working days';
            document.getElementById('statStdDev').textContent = stdDev.toFixed(2) + ' working days';
            document.getElementById('statMin').textContent = minDays.toFixed(1) + ' working days';
            document.getElementById('statMax').textContent = maxDays.toFixed(1) + ' working days';
            document.getElementById('statSpan').textContent = (maxDays - minDays).toFixed(1) + ' working days';

            document.getElementById('results').style.display = 'grid';
            document.getElementById('stats').style.display = 'block';

            drawDistributionChart(simulationResults);
        }

        function clearInputs() {
            document.getElementById('cycleTimes').value = '';
            document.getElementById('totalWork').value = '50';
            document.getElementById('simulations').value = '10000';
            document.getElementById('results').style.display = 'none';
            document.getElementById('stats').style.display = 'none';
            clearError();
        }

        // Auto-calculate on load with default values
        window.addEventListener('load', () => {
            calculateEstimate();
            
            // Add change listeners to all inputs
            document.getElementById('cycleTimes').addEventListener('change', calculateEstimate);
            document.getElementById('cycleTimes').addEventListener('input', calculateEstimate);
            document.getElementById('totalWork').addEventListener('change', calculateEstimate);
            document.getElementById('totalWork').addEventListener('input', calculateEstimate);
            document.getElementById('simulations').addEventListener('change', calculateEstimate);
            document.getElementById('simulations').addEventListener('input', calculateEstimate);
        });
    </script>
</body>
</html>
